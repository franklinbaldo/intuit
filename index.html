<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; style-src 'self' https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline';"
    />
    <title>URL to HTML</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <script src="utils.js" defer></script>
    <script src="js/main.js" defer></script>
    <script>
      // The htmz function needs to be globally available for the iframe's onload attribute.
      // If it were moved to main.js, it would need to be explicitly attached to the window object,
      // or the onload handler would need to be set programmatically in main.js.
      // For simplicity with the current structure, keeping it here is acceptable,
      // or it can be moved to main.js and main.js can set window.htmz = htmz;
      function htmz(frame) {
        setTimeout(() => {
          if (frame && frame.contentWindow) {
            const hash = frame.contentWindow.location.hash;
            if (hash) {
              if (frame.contentDocument) {
                const element = frame.contentDocument.querySelector(hash);
                if (
                  element &&
                  frame.contentDocument.body &&
                  frame.contentDocument.body.childNodes
                ) {
                  try {
                    element.replaceWith(
                      ...frame.contentDocument.body.childNodes,
                    );
                  } catch (e) {
                    console.error("Error during htmz replacement:", e);
                  }
                }
              }
            }
          }
        }, 0);
      }
    </script>
  </head>
  <body
    class="font-sans antialiased bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100"
  >
    <div class="container mx-auto p-8">
      <h1 class="text-3xl font-bold mb-4">URL to HTML</h1>
      <div
        id="errorMessage"
        class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4"
      ></div>
      <p class="mb-4">Rendered HTML:</p>
      <textarea
        id="htmlEditor"
        class="w-full h-64 border border-gray-300 rounded mb-4 p-2"
        placeholder="Type or paste your HTML here..."
      ></textarea>
      <button
        id="renderButton"
        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4"
      >
        Render
      </button>
      <button
        id="copyLinkButton"
        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4 ml-2"
      >
        Copy Link
      </button>
      <button
        id="clearEditorButton"
        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mb-4 ml-2"
      >
        Clear Editor
      </button>
      <button
        id="updateUrlButton"
        class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded mb-4 ml-2"
      >
        Update URL
      </button>
      <div class="mb-4">
        <input type="checkbox" id="sandboxToggle" class="mr-2" />
        <label
          for="sandboxToggle"
          class="text-sm text-gray-700 dark:text-gray-300"
          >Allow Scripts (Relaxed Sandbox)</label
        >
      </div>
      <div class="mb-4">
        <input type="checkbox" id="themeToggle" class="mr-2" />
        <label
          for="themeToggle"
          class="text-sm text-gray-700 dark:text-gray-300"
          >Dark Mode</label
        >
      </div>
      <iframe
        id="iframe"
        name="htmz"
        class="w-full h-96 border border-gray-300 rounded"
        onload="htmz(this)"
        sandbox=""
      ></iframe>
    </div>
  </body>
</html>
