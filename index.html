<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>URL to HTML</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const htmlData = urlParams.get('data');
      const b64Data = urlParams.get('b64'); // New: Get b64 parameter
      const iframe = document.getElementById('iframe').contentWindow.document;
      const htmlEditor = document.getElementById('htmlEditor');

      if (htmlData) {
        renderHTML(htmlData);
      } else if (b64Data) { // New: Check for b64Data
        try {
          const decodedHtml = atob(b64Data);
          renderHTML(decodedHtml);
        } catch (error) {
          console.error("Error decoding Base64 data: ", error);
          // Optionally, render a specific error message in the iframe or clear it
          // For now, it will just not render if b64 is malformed.
        }
      } else {
        const editorContent = htmlEditor.value;
        if (editorContent) {
          renderHTML(editorContent);
        }
      }

      const renderButton = document.getElementById('renderButton');
      const copyLinkButton = document.getElementById('copyLinkButton');
      const clearEditorButton = document.getElementById('clearEditorButton'); // New button

      renderButton.addEventListener('click', () => {
        const htmlContent = htmlEditor.value;
        renderHTML(htmlContent);
      });

      copyLinkButton.addEventListener('click', () => {
        const htmlContent = htmlEditor.value;
        const encodedHtml = encodeURIComponent(htmlContent);
        const baseUrl = window.location.origin + window.location.pathname;
        const shareableLink = `${baseUrl}?data=${encodedHtml}`;

        navigator.clipboard.writeText(shareableLink).then(() => {
          const originalButtonText = copyLinkButton.textContent;
          copyLinkButton.textContent = 'Copied!';
          setTimeout(() => {
            copyLinkButton.textContent = originalButtonText;
          }, 2000); // Revert after 2 seconds
        }).catch(err => {
          console.error('Failed to copy link: ', err);
          // You could also alert the user here if something goes wrong
        });
      });

      clearEditorButton.addEventListener('click', () => { // New event listener
        htmlEditor.value = ''; // Clear the editor
        renderHTML(''); // Clear the iframe
      });

      function renderHTML(html) {
        iframe.open();
        iframe.write(html);
        iframe.close();
      }
    });

    function htmz(frame) {
      setTimeout(() => {
        const hash = frame.contentWindow.location.hash;
        if (hash) {
          const element = frame.contentDocument.querySelector(hash);
          if (element) {
            element.replaceWith(...frame.contentDocument.body.childNodes);
          }
        }
      }, 0);
    }
  </script>
</head>
<body class="font-sans antialiased bg-gray-100 text-gray-800">
  <div class="container mx-auto p-8">
    <h1 class="text-3xl font-bold mb-4">URL to HTML</h1>
    <p class="mb-4">Rendered HTML:</p>
    <textarea id="htmlEditor" class="w-full h-64 border border-gray-300 rounded mb-4 p-2" placeholder="Type or paste your HTML here..."></textarea>
    <button id="renderButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4">Render</button>
    <button id="copyLinkButton" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4 ml-2">Copy Link</button>
    <button id="clearEditorButton" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mb-4 ml-2">Clear Editor</button>
    <iframe id="iframe" name="htmz" class="w-full h-96 border border-gray-300 rounded" onload="htmz(this)"></iframe>
  </div>
</body>
</html>
